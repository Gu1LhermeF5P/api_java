# --- Est치gio 1: "Build" (O Construtor) ---
FROM eclipse-temurin:17-jdk-focal AS builder

WORKDIR /workspace

COPY .mvn/ .mvn
COPY mvnw pom.xml ./

# 游뚿 --- CORRE칂츾O ADICIONADA AQUI --- 游뚿
# D치 permiss칚o de execu칞칚o ao script do Maven
RUN chmod +x mvnw
# ------------------------------------

# Baixa as depend칡ncias
RUN ./mvnw dependency:go-offline

# Copia o c칩digo-fonte
COPY src ./src

# Constroi o JAR, pulando os testes
RUN ./mvnw clean package -DskipTests


# --- Est치gio 2: "Runtime" (A Imagem Final) ---
FROM eclipse-temurin:17-jre-focal

WORKDIR /app

# Copia o JAR constru칤do no Est치gio 1
COPY --from=builder /workspace/target/api-0.0.1-SNAPSHOT.jar app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]